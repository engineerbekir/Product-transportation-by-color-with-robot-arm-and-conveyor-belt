#include <Servo.h>
Servo servo1;
Servo servo2;
Servo servo3;
Servo servo4;
Servo servo5;
Servo servo6;

#define servoPin1 2
#define servoPin2 3
#define servoPin3 4
#define servoPin4 5
#define servoPin5 6
#define servoPin6 10
//HC-SR04 mesafe sensörü
#define trigPin 50
#define ecoPin 52

//Konveyör bant
#define konveyor_Ileri 40
#define konveyor_Geri 38
#define hiz 10

//Renk sönsörü
#define s0 28
#define s1 30
#define s2 32
#define s3 34
#define out 36
int kirmizi, yesil, mavi;
String renk;

long distance,duration;
void setup()
{
  servo1.attach(servoPin1);
  servo2.attach(servoPin2);
  servo3.attach(servoPin3);
  servo4.attach(servoPin4);
  servo5.attach(servoPin5);
  servo6.attach(servoPin6);

  pinMode(s0, OUTPUT); //s0
  pinMode(s1, OUTPUT); //s1
  pinMode(s2, OUTPUT); //s2
  pinMode(s3, OUTPUT); //s3
  pinMode(out, INPUT); //out
  digitalWrite(s0, HIGH);
  digitalWrite(s1, LOW);


  pinMode(konveyor_Ileri,OUTPUT); //out
  pinMode(konveyor_Geri,OUTPUT); //out
  pinMode(hiz,OUTPUT); //out
 
  pinMode(trigPin, OUTPUT);
  pinMode(ecoPin, INPUT);
  
   Serial.begin(9600);
}
void loop()
{
   analogWrite(hiz,160);//bant hızını ayarlıyor
//KalibreEt();
  KalibreEdildi();
  digitalWrite(konveyor_Ileri,HIGH);
  digitalWrite(konveyor_Geri,LOW);
MesafeOlcme();   

   if (distance <4)
  {
  RenkBelirle();
    if (renk == "kirmizi")
    {
    analogWrite(hiz,0);
    Serial.println("kırmızı1111");
      
      Servo1_Kapat();
      delay(50);
      Servo2_Geri(90);
      delay(50);   
      Servo3_Sol();
      delay(50); 
      Servo1_Ac();
      delay(50);         
      Servo3_Sag();
      delay(50);        
      Servo2_Ileri(90);
      delay(50);
   
    }
  else  if (renk == "yesil")
    {
   analogWrite(hiz,0);
   Serial.println("yeşil");
      
      
      Servo1_Kapat();
      delay(50);
      Servo2_Geri(60);
      delay(50);   
      Servo3_Sol();
      delay(50); 
      Servo1_Ac();
      delay(50);         
      Servo3_Sag();
      delay(50);        
      Servo2_Ileri(60);
      delay(50);
   
   
    }
    else if (renk == "mavi")
    {
      analogWrite(hiz,0);
      Serial.println("mavi");
      
      
      Servo1_Kapat();
      delay(50);
      Servo2_Geri(30);
      delay(50);   
      Servo3_Sol();
      delay(50); 
      Servo1_Ac();
      delay(50);         
      Servo3_Sag();
      delay(50);        
      Servo2_Ileri(30);
      delay(50);
   
   
   
    }
delay(200);
  }
  

}

void RenkBelirle()
{
  if (kirmizi < 60)
  {
    renk="kirmizi";
  }
  else if (yesil < 60)
  {
     renk="yesil";
   }
  else if (mavi < 60)
  {
     renk="mavi";
  }
  delay(100);
}

void MesafeOlcme()
{
  digitalWrite(trigPin, LOW);
  delayMicroseconds(2);

  digitalWrite(trigPin, HIGH);
  delayMicroseconds(10);
  digitalWrite(trigPin, LOW);
  duration = pulseIn(ecoPin, HIGH);
  distance = duration * 0, 034 / 2;
  Serial.println("distance : " + distance);
}
void Servo1_Ac()
{
  for (int i = 0; i < 90; i++)
  {
    servo1.write(i);
    delay(50);
  }
}
void Servo1_Kapat()
{
  for (int i = 90; i > 0; i--)
  {
    servo1.write(i);
    delay(50);
  }
}
void Servo2_Geri(int deger)
{
  for (int i = deger; i >0; i--)
  {
   servo2.write(i);
    delay(50);
  }
}
void Servo2_Ileri(int deger)
{
  for (int i = 0; i <deger; i++)
  {
   servo2.write(i);
    delay(50);
  }
}
void Servo3_Sag()
{
  for (int i = 0; i <90; i++)
  {
   servo3.write(i);
    delay(50);
  }
}
void Servo3_Sol()
{
  for (int i = 90; i >0; i--)
  {
   servo3.write(i);
    delay(50);
  }
}
void KalibreEdildi()
{
  digitalWrite(s2, LOW);
  digitalWrite(s3, LOW);
  kirmizi = pulseIn(out, LOW);
  kirmizi = map(kirmizi, 50, 230, 0, 100);
  delay(100);

  digitalWrite(s2, HIGH);
  digitalWrite(s3, HIGH);
  yesil = pulseIn(out, LOW);
  yesil = map(yesil, 42, 210, 0, 100);
  delay(100);

  digitalWrite(s2, LOW);
  digitalWrite(s3, HIGH);
  mavi = pulseIn(out, LOW);
  mavi = map(mavi, 60, 220, 0, 100);
  delay(100);
  Serial.println();
}


void KalibreEt()
{
  digitalWrite(s2, LOW);
  digitalWrite(s3, LOW);
  kirmizi = pulseIn(out, LOW);
  Serial.print("kırmızı");
  Serial.print(kirmizi);
  Serial.print("      ");
  delay(100);

  digitalWrite(s2, HIGH);
  digitalWrite(s3, HIGH);
  yesil = pulseIn(out, LOW);
  Serial.print("yesiı");
  Serial.print(yesil);
  Serial.print("      ");
  delay(100);

  digitalWrite(s2, LOW);
  digitalWrite(s3, HIGH);
  mavi = pulseIn(out, LOW);
  Serial.print("mavi");
  Serial.print(mavi);
  Serial.print("      ");
  delay(100);
  Serial.println();
}
